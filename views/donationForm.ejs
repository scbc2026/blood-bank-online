<!DOCTYPE html>
<html>
<head>
    <title>Donation Entry - SCBC</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; }
        .header { background: #d9534f; color: white; padding: 15px; text-align: center; font-size: 24px; font-weight: bold; }
        .main-container { display: flex; gap: 20px; padding: 20px; max-width: 1200px; margin: auto; }
        .card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .left-panel { flex: 2; position: relative; } 
        .right-panel { flex: 1; height: fit-content; }
        
        .row { display: flex; gap: 15px; margin-bottom: 15px; }
        .input-group { flex: 1; }
        label { display: block; font-weight: 600; font-size: 13px; color: #555; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        .btn-save { width: 100%; padding: 15px; background: #28a745; color: white; border: none; font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 10px; }
        .btn-save:disabled { background: #ccc; cursor: not-allowed; color: #666; } 

        /* NAYA CODE: Alert Box & Blur Effect */
        .alert-box {
            background-color: #ffe6e6;
            color: #d8000c;
            border: 2px solid #d8000c;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 16px;
        }
        .blocked-overlay {
            opacity: 0.5; /* Dhundhla dikhega */
            pointer-events: none; /* Click nahi hoga */
        }
    </style>
</head>
<body>

    <div class="header">ü©∏ Shiva Charitable Blood Centre, Guna</div>

    <div class="main-container">
        
        <div class="card left-panel">
            
            <% if (isBlocked) { %>
                <div class="alert-box">
                    ‚ö†Ô∏è <%= alertMessage %>
                </div>
            <% } %>

            <h3>üìù Donation Entry Form</h3>
            
            <form action="/save-donation" method="POST" class="<%= isBlocked ? 'blocked-overlay' : '' %>">
                
                <input type="hidden" name="mobile" value="<%= donor.mobile %>">

                <div class="row" style="background: #fff3cd; padding: 10px; border-radius: 5px;">
                    <div class="input-group">
                        <label>üìÖ Donation Date</label>
                        <input type="date" name="donationDate" required value="<%= new Date().toISOString().split('T')[0] %>">
                    </div>
                </div>

                <div class="row">
                    <div class="input-group">
                        <label>Donor Name</label>
                        <input type="text" name="name" value="<%= donor.name %>" required>
                    </div>
                    <div class="input-group">
                        <label>Father's Name</label>
                        <input type="text" name="fatherName" value="<%= donor.fatherName %>" required>
                    </div>
                </div>

                <div class="row">
                    <div class="input-group">
                        <label>Mobile</label>
                        <input type="text" value="<%= donor.mobile %>" disabled style="background:#eee;">
                    </div>
                    <div class="input-group">
                        <label>Age</label>
                        <input type="number" name="age" value="<%= donor.age %>" required>
                    </div>
                    <div class="input-group">
                        <label>Gender</label>
                        <select name="gender" required>
                            <option value="">Select</option>
                            <option value="Male" <%= donor.gender == 'Male' ? 'selected' : '' %>>Male</option>
                            <option value="Female" <%= donor.gender == 'Female' ? 'selected' : '' %>>Female</option>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="input-group">
                        <label>Blood Group</label>
                        <select name="bloodGroup" required>
                            <option value="<%= donor.bloodGroup %>"><%= donor.bloodGroup || 'Select' %></option>
                            <option value="A+">A+</option><option value="B+">B+</option><option value="O+">O+</option><option value="AB+">AB+</option>
                            <option value="A-">A-</option><option value="B-">B-</option><option value="O-">O-</option><option value="AB-">AB-</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Address</label>
                        <input type="text" name="address" value="<%= donor.address %>" required>
                    </div>
                </div>

                <hr>

                <div class="row">
                    <div class="input-group">
                        <label>Bag Number</label>
                        <input type="text" name="bagNumber" placeholder="Code+YY+Series">
                    </div>
                    <div class="input-group">
                        <label>Donation Type</label>
                        <select name="donationType">
                            <option value="Voluntary">Voluntary</option>
                            <option value="Replacement">Replacement</option>
                        </select>
                    </div>
                </div>

                <h4 style="margin-bottom:10px;">üî¨ Lab Results</h4>
                <div class="row">
                    <div class="input-group"><label>HIV</label><select name="hiv"><option>Non-Reactive</option><option>Reactive</option></select></div>
                    <div class="input-group"><label>HBsAg</label><select name="hbsag"><option>Non-Reactive</option><option>Reactive</option></select></div>
                    <div class="input-group"><label>HCV</label><select name="hcv"><option>Non-Reactive</option><option>Reactive</option></select></div>
                </div>
                <div class="row">
                    <div class="input-group"><label>Syphilis</label><select name="syphilis"><option>Non-Reactive</option><option>Reactive</option></select></div>
                    <div class="input-group"><label>Malaria</label><select name="malaria"><option>Non-Reactive</option><option>Positive</option></select></div>
                </div>

                <% if (isBlocked) { %>
                    <button type="button" class="btn-save" disabled>‚ùå Entry Blocked (Rest Period / TTI)</button>
                <% } else { %>
                    <button type="submit" class="btn-save">‚úÖ Save Donation Entry</button>
                <% } %>

            </form>
        </div>

        <div class="card right-panel">
            <h3>üìú Previous History</h3>
            <% if (history.length > 0) { %>
                <table style="width:100%; font-size:13px; border-collapse:collapse;">
                    <thead><tr style="background:#eee; text-align:left;"><th>Date</th><th>Result</th></tr></thead>
                    <tbody>
                        <% history.forEach(function(item) { %>
                            <tr style="border-bottom:1px solid #ddd;">
                                <td style="padding:8px;"><%= item.donationDate.toDateString() %></td>
                                <td>
                                    <% if(item.hiv=='Reactive' || item.hbsag=='Reactive' || item.hcv=='Reactive' || item.syphilis=='Reactive') { %> 
                                        <span style="color:red; font-weight:bold;">Reactive</span> 
                                    <% } else { %>
                                        <span style="color:green;">Safe</span>
                                    <% } %>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            <% } else { %>
                <p>No previous records.</p>
            <% } %>
            <br>
            <a href="/dashboard" style="display:block; text-align:center; color:#d9534f; text-decoration:none;">&larr; Back to Search</a>
        </div>
    </div>

</body>
</html>