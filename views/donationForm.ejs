<!DOCTYPE html>
<html>
<head>
    <title>Donation Entry - SCBC</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; }
        .header { background: #d9534f; color: white; padding: 15px; text-align: center; font-size: 24px; font-weight: bold; }
        .card { box-shadow: 0 4px 8px rgba(0,0,0,0.1); border: none; border-radius: 10px; }
        .form-label { font-weight: 600; color: #555; }
        .btn-save { width: 100%; padding: 12px; font-size: 18px; font-weight: bold; border-radius: 5px; }
        .alert-box { background-color: #ffe6e6; color: #d8000c; border: 2px solid #d8000c; padding: 15px; border-radius: 5px; margin-bottom: 20px; font-weight: bold; }
        .blocked-overlay { opacity: 0.6; pointer-events: none; filter: grayscale(100%); }
    </style>
</head>
<body>

    <div class="header">ü©∏ Shiva Charitable Blood Centre, Guna</div>

    <div class="container mt-4">
        <div class="row">
            
            <div class="col-lg-8">
                <div class="card p-4">
                    
                    <% if (isBlocked) { %>
                        <div class="alert-box">
                            ‚ö†Ô∏è <%= alertMessage %> <br>
                            <small>Entry is strictly prohibited as per NACO guidelines.</small>
                        </div>
                    <% } %>

                    <h3 class="mb-4 text-primary">üìù Donation Entry Form</h3>
                    
                    <form action="/save-donation" method="POST" class="<%= isBlocked ? 'blocked-overlay' : '' %>">
                        
                        <div class="form-row p-2 mb-3 bg-light border rounded">
                            <div class="col-md-6">
                                <label class="form-label">üìÖ Donation Date</label>
                                <input type="date" name="donationDate" class="form-control" required value="<%= new Date().toISOString().split('T')[0] %>">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Donation Type</label>
                                <select name="donationType" class="form-control">
                                    <option value="Voluntary">Voluntary</option>
                                    <option value="Replacement">Replacement</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Donor Name</label>
                                <input type="text" name="name" class="form-control" value="<%= donor.name %>" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Father's Name</label>
                                <input type="text" name="fatherName" class="form-control" value="<%= donor.fatherName %>" required>
                            </div>
                        </div>

                        <div class="form-row bg-white border p-2 rounded mb-3">
                            <div class="col-md-6 mb-3">
                                <label class="form-label text-danger">Mobile Number *</label>
                                <input type="number" name="mobile" class="form-control" 
                                       value="<%= donor.mobile %>" placeholder="10 Digit Mobile" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label text-primary">Aadhaar Number (Optional)</label>
                                <input type="number" name="aadhaar" class="form-control" 
                                       value="<%= donor.aadhaar || '' %>" placeholder="12 Digit Aadhaar">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Age</label>
                                <input type="number" name="age" class="form-control" value="<%= donor.age %>" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Gender</label>
                                <select name="gender" class="form-control" required>
                                    <option value="">Select</option>
                                    <option value="Male" <%= donor.gender == 'Male' ? 'selected' : '' %>>Male</option>
                                    <option value="Female" <%= donor.gender == 'Female' ? 'selected' : '' %>>Female</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Blood Group</label>
                                <select name="bloodGroup" class="form-control" required>
                                    <option value="<%= donor.bloodGroup %>"><%= donor.bloodGroup || 'Select' %></option>
                                    <option value="A+">A+</option><option value="B+">B+</option><option value="O+">O+</option><option value="AB+">AB+</option>
                                    <option value="A-">A-</option><option value="B-">B-</option><option value="O-">O-</option><option value="AB-">AB-</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Bag Number</label>
                                <input type="text" name="bagNumber" class="form-control" placeholder="Bag No.">
                            </div>
                        </div>

                        <div class="form-group mb-3">
                            <label class="form-label">Address</label>
                            <input type="text" name="address" class="form-control" value="<%= donor.address %>" required>
                        </div>

                        <hr>

                        <h5 class="text-secondary mb-3">üî¨ Lab Testing (TTI)</h5>
                        <div class="form-row">
                            <div class="col-md-2"><label>HIV</label><select name="hiv" class="form-control"><option>Non-Reactive</option><option>Reactive</option></select></div>
                            <div class="col-md-2"><label>HBsAg</label><select name="hbsag" class="form-control"><option>Non-Reactive</option><option>Reactive</option></select></div>
                            <div class="col-md-2"><label>HCV</label><select name="hcv" class="form-control"><option>Non-Reactive</option><option>Reactive</option></select></div>
                            <div class="col-md-2"><label>Syphilis</label><select name="syphilis" class="form-control"><option>Non-Reactive</option><option>Reactive</option></select></div>
                            <div class="col-md-2"><label>Malaria</label><select name="malaria" class="form-control"><option>Non-Reactive</option><option>Positive</option></select></div>
                            <div class="col-md-2"><label>Remark</label><input type="text" name="remark" class="form-control" placeholder="Any Note"></div>
                        </div>

                        <br>

                        <% if (isBlocked) { %>
                            <button type="button" class="btn btn-secondary btn-save" disabled>‚ùå BLOCKED (Rest Period / TTI)</button>
                        <% } else { %>
                            <button type="submit" class="btn btn-success btn-save">‚úÖ Save Donation Entry</button>
                        <% } %>

                    </form>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card p-3">
                    <h5 class="text-info">üìú Previous History</h5>
                    <hr>
                    <% if (history.length > 0) { %>
                        <table class="table table-sm table-bordered">
                            <thead class="thead-light"><tr><th>Date</th><th>Result</th></tr></thead>
                            <tbody>
                                <% history.forEach(function(item) { %>
                                    <tr>
                                        <td><%= item.donationDate.toDateString() %></td>
                                        <td>
                                            <% if(item.hiv=='Reactive' || item.hbsag=='Reactive' || item.hcv=='Reactive' || item.syphilis=='Reactive') { %> 
                                                <span class="badge badge-danger">REACTIVE</span> 
                                            <% } else { %>
                                                <span class="badge badge-success">Safe</span>
                                            <% } %>
                                        </td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    <% } else { %>
                        <p class="text-muted text-center">No previous records found.</p>
                    <% } %>
                    <br>
                    <a href="/dashboard" class="btn btn-outline-danger btn-block">&larr; Back to Search</a>
                </div>
            </div>

        </div>
    </div>

</body>
</html>
